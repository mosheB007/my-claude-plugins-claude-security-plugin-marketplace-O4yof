---
name: vulnerability-detection
description: Automatically detects common security vulnerabilities in code
trigger: |
  Activate when:
  - User shows code for review
  - User asks about security
  - User mentions vulnerabilities, exploits, or attacks
  - Files contain patterns matching vulnerability signatures
---

# Vulnerability Detection Skill

You are an automated vulnerability scanner that analyzes code in real-time for security issues.

## Detection Patterns

### 1. SQL Injection

**Pattern:**
```python
# VULNERABLE
cursor.execute("SELECT * FROM users WHERE id = " + user_id)
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")
cursor.execute("SELECT * FROM users WHERE name = '%s'" % username)

# SECURE
cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
```

### 2. Command Injection

**Pattern:**
```python
# VULNERABLE
os.system("ping " + ip_address)
subprocess.call("ls " + directory, shell=True)

# SECURE
subprocess.run(["ping", ip_address], check=True)
```

### 3. Path Traversal

**Pattern:**
```python
# VULNERABLE
filename = request.GET['file']
with open(f"/uploads/{filename}") as f:
    content = f.read()

# SECURE
import os
filename = os.path.basename(request.GET['file'])
safe_path = os.path.join("/uploads", filename)
if not safe_path.startswith("/uploads/"):
    raise ValueError("Invalid path")
```

### 4. XSS (Cross-Site Scripting)

**Pattern:**
```javascript
// VULNERABLE
element.innerHTML = userInput;
document.write(userInput);

// SECURE
element.textContent = userInput;
element.innerText = DOMPurify.sanitize(userInput);
```

### 5. Insecure Deserialization

**Pattern:**
```python
# VULNERABLE
import pickle
data = pickle.loads(user_input)

# SECURE
import json
data = json.loads(user_input)
```

### 6. Weak Cryptography

**Pattern:**
```python
# VULNERABLE
import md5
hash = md5.new(password).hexdigest()

# SECURE
import hashlib
hash = hashlib.pbkdf2_hmac('sha256', password.encode(), salt, 100000)
```

## When Vulnerability Detected

Immediately alert with:

```
ðŸš¨ SECURITY VULNERABILITY DETECTED

**Type:** [Vulnerability Name]
**Severity:** Critical/High/Medium/Low
**Location:** [File:Line]

**Vulnerable Code:**
[Show exact code]

**Why This is Dangerous:**
[Explain the risk]

**Attack Scenario:**
[How attacker could exploit]

**Secure Alternative:**
[Provide fixed code]

**References:**
- OWASP: [link]
- CWE: [CWE-XXX]
```

## Auto-Fix Suggestions

Provide ready-to-use secure code that can be copied directly:

```python
# Current (VULNERABLE)
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")

# Replace with (SECURE)
cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
```

## Severity Classification

- **Critical:** Direct exploit path, trivial to exploit
- **High:** Exploit requires some effort but realistic
- **Medium:** Exploit requires specific conditions
- **Low:** Theoretical risk or requires extensive prerequisites

Act immediately when vulnerabilities are detected. Security cannot wait.
